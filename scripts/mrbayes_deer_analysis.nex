#!/bin/bash
#
# run_mrbayes.sh
#
# Reproducible Script for Running MrBayes on Project Data
#
# Chosen Method: Bayesian Inference using MrBayes with MCMC
#
# Description:
# MrBayes uses Markov Chain Monte Carlo (MCMC) methods to estimate the posterior distribution
# of phylogenetic trees. The analysis below employs a substitution model with six rate categories
# (nst=6) and gamma-distributed rate variation. The MCMC is run for 1,000,000 generations with sampling,
# printing, and diagnostic frequencies as specified.
#
# Assumptions:
# - Sites evolve independently under the same model.
# - The chosen substitution model (nst=6 with gamma rates) fits the data.
# - The MCMC chains converge to a stationary distribution.
#
# Limitations:
# - Results are sensitive to prior choices and model mis-specification.
# - Long runtimes may be required for large datasets or complex models.
#
# MrBayes Block (to be included in your Nexus file):
#
#     #NEXUS
#
#     Begin MrBayes;
#
#         [Method: Bayesian Inference using MrBayes]
#         [MrBayes uses MCMC methods to estimate the posterior distribution of phylogenetic trees.]
#
#         [Assumptions:]
#         [ - Sites evolve independently under the same model.]
#         [ - The chosen substitution model fits the data.]
#         [ - Chains converge to a stationary distribution.]
#
#         [Limitations:]
#         [ - Sensitive to prior choices and model mis-specification.]
#         [ - Long runtimes for large datasets or complex models.]
#
#         set autoclose=yes nowarn=yes;
#
#         execute "deer alignment.nexus";
#
#         lset nst=6 rates=gamma;
#         mcmc ngen=1000000 samplefreq=100 printfreq=100 diagnfreq=1000 nchains=4 savebrlens=yes;
#         sump burnin=2500;
#         sumt burnin=2500;
#
#     End;
#
# How to Use This Script:
#
# 1. Prepare Your Environment:
#    Ensure MrBayes is installed on your Ubuntu system. If not, install it using:
#         sudo apt-get install mrbayes
#
# 2. Verify the File Path:
#    Confirm that your Nexus file ("deer alignment.nexus") is accessible in the current directory.
#
# 3. Make the Script Executable:
#         chmod +x run_mrbayes.sh
#
# 4. Run the Script:
#         ./run_mrbayes.sh
#
# 5. Version Control:
#    Commit this script to your GitHub repository and push the changes:
#         git add run_mrbayes.sh
#         git commit -m "Added reproducible MrBayes analysis script"
#         git push
#
# 6. Submit the GitHub commit link via Canvas as required.
#

# Define the Nexus file path (should contain your alignment and MrBayes commands)
NEXUS_FILE="deer alignment.nexus"

# Check if the Nexus file exists
if [ ! -f "$NEXUS_FILE" ]; then
    echo "Error: Nexus file '$NEXUS_FILE' not found."
    exit 1
fi

echo "Running MrBayes analysis on file: $NEXUS_FILE"

# Run MrBayes on the Nexus file.
# The command 'mb' is used to invoke MrBayes.
mb "$NEXUS_FILE"

echo "MrBayes analysis complete. Check the output files generated by MrBayes."

